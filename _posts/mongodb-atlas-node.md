---
layout: post
title: Learn how to set up a database in MongoDB Atlas and connect to it using Node.js, with examples
---

In this blog, you will learn how to set a new MongoDB Atlas "NoSQL" database, connect to it through Node.js and add and get data. Here's what we will do:
- Create and configure a new MongoDB Atlas account
- Use Node.js to connect to our database, add a new document and get documents

I have set up a nicely organized Node.js shell program you can have.

As usual, you can find a fully working project on my [GitHub](https://github.com/DaveStaudenmaier/mongodb-atlas-node)

Node.js version 12.18.3

----
****
## Overview

In this blog we will
## What is MongoDB Atlas?

MongoDB is a document-oriented, "NoSQL"

MongoDB is a cross-platform document-oriented database program that uses JSON-like documents with optional schemas.  [MongoDB Atlas](https://www.mongodb.com/cloud/atlas) is a cloud-hosted MongoDB service where you can deploy, operate and scale MongoDB database starting with a free-tier.

## Create an Account in MongoDB Atlas

Go to [https://www.mongodb.com/cloud/atlas](https://www.mongodb.com/cloud/atlas) and click the *Start Free* button.

<img src="/images/blog/mongodb-atlas-node/getting-started1.png">

Register a new Account.

<img src="/images/blog/mongodb-atlas-node/register.png" height="500px">

MongoDB Atlas offers many options for your application.   For our purposes, we will use the Free Tier, which is always a good idea to get started.

<img src="/images/blog/mongodb-atlas-node/cluster.png" height="500px">

Next, it will ask you where you want to host the cluster.  I chose AWS.  Click the *Create Cluster* button.

<img src="/images/blog/mongodb-atlas-node/hosting.png" height="500px">

It will take a few minutes to set up your account.   Note that in the lower left, it will walk you through the steps we are about to go through.

<img src="/images/blog/mongodb-atlas-node/creating.png" height="500px">

## Set up a Database User

When your cluster is created, click on the *Database Access* button and then click the *Add Database User* button to create a database user.

<img src="/images/blog/mongodb-atlas-node/database-user1.png">

For the free-tier, we can set up a password.  I called the user 'Admin' and used an *Autogenerated Secure Password*.  Be sure to copy the password and save it. You will need it later when accessing from Node.js and then press the *Update User* button.  It may take a few minutes to set up your database user access. Please note that this account in this blog was deleted after I created this blog so my credentials no longer work.

<img src="/images/blog/mongodb-atlas-node/database-user2.png" height="500px">

## Set up Network Access

Click on the *Network Access* button and then click the *Add IP Address* button.  

<img src="/images/blog/mongodb-atlas-node/network-access1.png">

Next, you can whitelist a specific IP address or you can allow access from anywhere.  We will allow access form anywhere by clicking the *Allow Access From Anywhere* button and then clicking the *Confirm* button.   It may take a few minutes to set up your network access.

<img src="/images/blog/mongodb-atlas-node/network-access2.png">

## Load Sample Data

This optional step will load some sample data that you can use to try out MongoDB Atlas and learn how to configure schemas.  If you would like to do this, click the elipsis next to the *Collections* button and select *Load Sample Dataset*.

<img src="/images/blog/mongodb-atlas-node/sample-data1.png">

It will take a few minutes to load the data and then you will see several different databases with dataasets like this.

<img src="/images/blog/mongodb-atlas-node/sample-data3.png" height="500px">

We are not going to use the sample data.  I will show you how you can use Node.js and Mongoose to create a database and documents from Node.js!

## Connecting to the Cluster

The last step is to get the connection information we will need to access our cluster.  Click the *Connect* button.

<img src="/images/blog/mongodb-atlas-node/connect0.png">

There are three ways to connect to your MongoDB Atlas database.   We are going to use the *Connect Your Application* option. 

<img src="/images/blog/mongodb-atlas-node/connect1.png" height="500px">

Select the Node.js driver and click the *Copy* button to copy the connection string.  Save this for the next step.

<img src="/images/blog/mongodb-atlas-node/connect3.png" height="500px">

## Overview of Node.js shell

You can download the Node.js shell (with all of the Mongoose) code from my [GitHub](https://github.com/DaveStaudenmaier/mongodb-atlas-node).  Here is a brief overview of what's included and how it is structured.

The entry point is *server.js* which sets up listening on port and adds in *app.js*.

*app.js* adds in other important libraries like *express* and *body-parser*, our database models from *db.js*, our routes from *routes.js* and CORS.  

<img src="/images/blog/mongodb-atlas-node/node-structure.png">

## Database set up in Node.js

Let's look at our database configuration in *db.js*.  

```javascript
var mongoose = require('mongoose');
var gracefulShutdown;

// TODO: Secure production MongoDB Atlas to only accept calls from production server

mongoose.connect(process.env.MONGO_CONNECT, { autoIndex: false });
mongoose.set('useFindAndModify', false);

// CONNECTION EVENTS
mongoose.connection.on('connected', function() {
  console.log('Mongoose connected');
});
mongoose.connection.on('error', function(err) {
  console.log('Mongoose connection error: ' + err);
});
mongoose.connection.on('disconnected', function() {
  console.log('Mongoose disconnected');
});

// Capture App Termination / restart events
// To be called when process is restarted or terminated
gracefulShutdown = function(msg, callback) {
  mongoose.connection.close(function() {
    console.log('Mongoose disconnected through ' + msg);
    callback();
  });
};
// For nodemon restarts
process.once('SIGUSR2', function() {
  gracefulShutdown('nodemon restart', function() {
    process.kill(process.pid, 'SIGUSR2');
  });
});
// For app termination
process.on('SIGINT', function() {
  gracefulShutdown('app termination', function() {
    process.exit(0);
  });
});

// Bring in Schemas and Models
require('./test');

```
## Conclusion



Feel free to contact me at [dave@dev-reboot.com](mailto:dave@dev-reboot.com) if you have any questions or comments!

Keep on developing!
